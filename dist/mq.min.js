/*! @sedlak.r/mq@1.2.0 2025-02-24 */
globalThis.MQ&&console.warn("MQ already exists on globalThis, redefining"),globalThis.MQ={},MQ.Timer=function(e){"use strict";function t(e,t){this.timeout=e||30,this.timer=0,this.callback=t}return(e=t.prototype).run=function(){this.timer||(this.timer=setTimeout(function(e){this.cancel(),e()}.bind(this,this.callback),this.timeout))},e.cancel=function(){this.timer&&(clearTimeout(this.timer),this.timer=0)},e.version="1.0",t}(void MQ),MQ.Store=function(E,e){"use strict";function w(e,t){var n=e[t];return n||(e[t]=n=[]),n}function r(e,t,n,r){if(null!=n){var i,o,a,l=e,s=t,u=r,c=w(l,n),r=c.length;if(s===E.mqDefault)l[n]=[];else for(i=r-1;0<=i;i--)o=c[i],a=u&&o.context===s&&o.handler===u||!u&&o.context===s,(o.removed=a)&&c.splice(i,1)}else{var h,m,d,f,v,p=e,g=t,b=g===E.mqDefault;for(m in p)if(p.hasOwnProperty(m))for(h=(d=p[m]).length-1;0<=h;h--)v=(f=d[h]).context===g||b,(f.removed=v)&&d.splice(h,1)}}function i(e,t){this.context=e,this.handler=t,this.removed=!1}function t(){this.store={}}return(e=t.prototype).save=function(e,t,n){t=t.toLowerCase(),w(this.store,t).push(new i(e,n))},e.remove=function(e,t,n){t=t&&t.toLowerCase(),r(this.store,e,t,n)},e.evaluate=function(e,t){e=e.toLowerCase();for(var n,r=w(this.store,e),i=t,o=(r=r.slice(0)).length,a=0;a<o;a++)(n=r[a]).removed||n.handler.apply(n.context,i?[i]:[])},e.request=function(e,t){e=e.toLowerCase();var n=w(this.store,e),r=n.length;if(0===r)throw"EventEmitter: Can not make request on event that has not handler for '"+e+"'.";if(1<r)throw"EventEmitter: Can not make request on event that has more then one handler. Use EventEmitter.event('"+e+"') instead.";return void 0===(n=(r=n[0]).handler.apply(r.context,t?[t]:[]))&&console.warn("EventEmitter: Return from request '"+e+"' is empty! This is might not be valid state."),n},e.demand=function(e,t){e=e.toLowerCase();var n,r=w(this.store,e),i=r.length;if(1<i)throw"EventEmitter: Can not make demand on event that has more then one handler. Use EventEmitter.event('"+e+"') instead.";return n=i?(e=r[0]).handler.apply(e.context,t?[t]:[]):n},e.watching=function(e){return e=e.toLowerCase(),w(this.store,e).length},e.version="1.0",t}(MQ),MQ.Emitter=function(g,r){"use strict";var i,o=[],a=[],l=!1,s=!1,b=new g.Store;function u(e,t,n,r){var i,o,a,l;"tripleclick"===t?(i=e,l=a=0,(o=n).tripleDblClickHandler=function(e){document.body.addEventListener||o.tripleClickHandler(e||globalThis.event)},o.tripleClickHandler=function(e){e=e||globalThis.event,l>(new Date).getTime()-400?3===(a+=1)&&(a=0,o(e)):(a=1,l=0),l=l||(new Date).getTime()},u(i,"click",o.tripleClickHandler),u(i,"dblclick",o.tripleDblClickHandler)):(n.eventDoneRuntime=n.eventDoneRuntime||function(e){n(globalThis.event||e)},e.addEventListener?e.addEventListener(t,n.eventDoneRuntime,r??!1):(e=e===globalThis?document:e).attachEvent("on"+t,n.eventDoneRuntime),"mousewheel"===t&&u(e,"DOMMouseScroll",n.eventDoneRuntime))}function E(e,t,n){var r,i;"tripleclick"===t?(E(r=e,"click",(i=n).tripleClickHandler),E(r,"dblclick",i.tripleDblClickHandler),delete(r=i).tripleClickHandler,delete r.tripleDblClickHandler,c(i)):(e.removeEventListener?e.removeEventListener(t,n.eventDoneRuntime):(e=e===globalThis?document:e).detachEvent("on"+t,n.eventDoneRuntime),"mousewheel"===t&&E(e,"DOMMouseScroll",n.eventDoneRuntime),c(n))}function c(e){delete e.element,delete e.type,delete e.context}function h(e,t,n,r){console&&l&&(0<=a.indexOf(t)||(console[e]?console[e]("EventEmitter: ("+(new Date).toLocaleTimeString()+") "+n,s?"":r):console.info("EventEmitter: ("+(new Date).toLocaleTimeString()+") "+n,s?"":r)))}function e(e){this.context=g.mqDefault,this.isStatic=e||!1}return g.mqDefault=globalThis,(r=e.prototype).create=function(e){return(new g.Emitter).in(e)},r.event=function(e,t){return h("debug",e,"Event for '"+e+"' send with parameters ",t),b.evaluate(e,t),this},r.notify=function(e,t){var n={};return h("debug",e,"Notify for '"+e+"' send with parameters ",t),n.name=e,n.params=t,o.push(n),i||(i=new g.Timer(30,function(){for(var e=o.shift();e;)b.evaluate(e.name,e.params),e=o.shift();i.cancel(),i=null})).run(),i},r.request=function(e,t){var n=b.request(e,t);return h("debug",e,"Request for '"+e+"' return '"+n+"' for parameters ",t),n},r.demand=function(e,t){var n=b.demand(e,t);return h("debug",e,"Demand for '"+e+"' return '"+n+"' for parameters ",t),n},r.watching=function(e){var t=b.watching(e);return h("debug",e,"Watching count status for '"+e+"' return '"+t,[]),t},r.subscribe=function(e,t,n,r,i){var o,a,l=this.context,e=function(e,t,n,r){var i,o,a;if("string"==typeof e&&"function"==typeof t)return{element:null,name:e,handler:t,params:r||[]};if(i=e.nodeType&&1===e.nodeType,o=e===document,a=e===globalThis,(i||a||o)&&"string"==typeof t&&"function"==typeof n)return{element:e,name:t,handler:n,params:r||[]};throw"EventEmitter: Incorrect parameters given into function subscribe() or unsubscribe()."}(e,t,n,r);function s(e){a.handler.apply(o,[[e].concat(a.params)])}return e.element?u(e.element,e.name,(o=l,t=(a=e).handler.handlers=a.handler.handlers||[],s.element=a.element,s.type=a.name,s.context=o,t.push(s),s),i):b.save(this.context,e.name,e.handler),this},r.unsubscribe=function(e,t,n){t=t,n=n;var r,i,o=void 0===(e=e)||void 0===t?{element:null,name:null,handler:null}:"string"==typeof e&&"function"==typeof t?{element:null,name:e,handler:t}:(o=e.nodeType&&1===e.nodeType,r=e===document,i=e===globalThis,(o||i||r)&&"string"==typeof t&&"function"==typeof n?{element:e,name:t,handler:n}:null);if(this.context!==g.mqDefault||o.name||o.handler||console.warn("EventEmitter: You are calling unsubscribe method without parameters. This is unbind all event through application!"),o.element){for(var a,l,s,u,c=this.context,h=o,m=[],d=h.name,f=h.element,v=h.handler.handlers||[],p=v.length-1;0<=p;p--)u=(s=v[p]).element,a=s.type,l=s.context,u===f&&d===a&&l===c?E(h.element,h.name,s):m.push(s);h.handler.handlers=m}else b.remove(this.context,o.name,o.handler);return this},r.interrupt=function(e,t,n){t&&((t=e).cancelBubble=!0,void 0!==t.stopPropagation)&&t.stopPropagation(),n&&((t=(t=e)||globalThis.event).preventDefault&&t.preventDefault(),t.returnValue=!1)},r.in=function(e){if(this.isStatic)throw"EventEmitter: Can not change context on static method. Use EventEmitter.create() with right context.";return this.context=e,this},r.debugMode=function(e,t,n){a=t||[],l=e,s=n,r.getStore=e?function(){return b}:void 0,console.info("EventEmitter debug mode is set to "+(e?"on":"off")+" "+(n?"with simple mode":""))},r.version="1.0",e}(MQ),globalThis.EventEmitter&&console.warn(" EventEmitter already exists on globalThis, redefining"),globalThis.EventEmitter=new MQ.Emitter(!0);