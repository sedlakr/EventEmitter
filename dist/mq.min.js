/*! @sedlak.r/mq@1.4.0 2025-04-09 */
globalThis.MQ&&console.warn("MQ already exists on globalThis, redefining"),globalThis.MQ={},MQ.Timer=function(e){"use strict";function t(e,t){this.timeout=e||30,this.timer=0,this.callback=t}return(e=t.prototype).run=function(){this.timer||(this.timer=setTimeout(function(e){this.cancel(),e()}.bind(this,this.callback),this.timeout))},e.cancel=function(){this.timer&&(clearTimeout(this.timer),this.timer=0)},e.version="1.0",t}(void MQ),MQ.Store=function(f,e){"use strict";function d(e,t){let n=e[t];return n||(n=[],e[t]=n),n}function o(e,t,n){var r=e.length;if(0===r)throw new Error("EventEmitter: Can not make request on event that has not handler for '"+t+"'.");if(1<r)throw new Error("EventEmitter: Can not make request on event that has more then one handler. Use EventEmitter.event('"+t+"') instead.");return void 0===(e=(r=e[0]).handler.apply(r.context,n?[n]:[]))&&console.warn("EventEmitter: Return from request '"+t+"' is empty! This is might not be valid state."),e}function r(a,s,o,l){if(null==o){var u=a;var c=s;let e,t,n,r,i,o,l=c===f.mqDefault;for(t in u)if(u.hasOwnProperty(t))for(i=(n=u[t]).length,e=i-1;0<=e;e--)o=(r=n[e]).context===c||l,(r.removed=o)&&n.splice(e,1)}else{var h=s;s=o;var m=l;let e,t,n,r=d(a,s),i=r.length;if(h===f.mqDefault)a[s]=[];else for(e=i-1;0<=e;e--)t=r[e],n=m&&t.context===h&&t.handler===m||!m&&t.context===h,(t.removed=n)&&r.splice(e,1)}}function i(e,t){this.context=e,this.handler=t,this.removed=!1}function t(){this.store={}}function l(e){return e.toLowerCase()}return(e=t.prototype).save=function(e,t,n){t=t.toLowerCase(),d(this.store,t).push(new i(e,n))},e.remove=function(e,t,n){t=t&&t.toLowerCase(),r(this.store,e,t,n)},e.evaluate=function(r,i){r=r.toLowerCase();{var o=d(this.store,r),l=i;let e,t,n;for(t=(o=o.slice(0)).length,e=0;e<t;e++)(n=o[e]).removed||n.handler.apply(n.context,l?[l]:[])}},e.request=function(e,t){e=l(e);return o(d(this.store,e),e,t)},e.ctxRequest=function(e,t,n){var r,i,t=l(t);return o((r=this.store,i=e,d(r,t).filter(e=>e.context===i)),t,n)},e.demand=function(r,i){r=r.toLowerCase();{var o=d(this.store,r);let e,t,n=o.length;if(1<n)throw"EventEmitter: Can not make demand on event that has more then one handler. Use EventEmitter.event('"+r+"') instead.";return n&&(e=o[0],t=e.handler.apply(e.context,i?[i]:[])),t}},e.watching=function(e){return e=e.toLowerCase(),d(this.store,e).length},e.version="1.0",t}(MQ),MQ.Emitter=function(o,r){"use strict";let i,l=[],a=[],s=!1,u=!1,m=new o.Store;function c(e,t,r,n){if("tripleclick"===t){var i=e,o=r;let t=0,n=0;o.tripleDblClickHandler=function(e){document.body.addEventListener||o.tripleClickHandler(e||globalThis.event)},o.tripleClickHandler=function(e){e=e||globalThis.event,n>(new Date).getTime()-400?3===(t+=1)&&(t=0,o(e)):(t=1,n=0),n=n||(new Date).getTime()},c(i,"click",o.tripleClickHandler),c(i,"dblclick",o.tripleDblClickHandler)}else r.eventDoneRuntime=r.eventDoneRuntime||function(e){r(globalThis.event||e)},e.addEventListener(t,r.eventDoneRuntime,n??!1),"mousewheel"===t&&c(e,"DOMMouseScroll",r.eventDoneRuntime)}function f(e,t,n){var r,i;"tripleclick"===t?(f(r=e,"click",(i=n).tripleClickHandler),f(r,"dblclick",i.tripleDblClickHandler),delete(r=i).tripleClickHandler,delete r.tripleDblClickHandler,h(i)):(e.removeEventListener(t,n.eventDoneRuntime),"mousewheel"===t&&f(e,"DOMMouseScroll",n.eventDoneRuntime),h(n))}function h(e){delete e.element,delete e.type,delete e.context}function d(e,t,n,r){console&&s&&(0<=a.indexOf(t)||(console[e]?console[e]("EventEmitter: ("+(new Date).toLocaleTimeString()+") "+n,u?"":r):console.info("EventEmitter: ("+(new Date).toLocaleTimeString()+") "+n,u?"":r)))}function e(e){this.context=o.mqDefault,this.isStatic=e||!1}return o.mqDefault=globalThis,(r=e.prototype).create=function(e){return(new o.Emitter).in(e)},r.event=function(e,t){return d("debug",e,"Event for '"+e+"' send with parameters ",t),m.evaluate(e,t),this},r.notify=function(e,t){var n={};return d("debug",e,"Notify for '"+e+"' send with parameters ",t),n.name=e,n.params=t,l.push(n),i||(i=new o.Timer(30,function(){{let e=l.shift();for(;e;)m.evaluate(e.name,e.params),e=l.shift()}i.cancel(),i=null})).run(),i},r.request=function(e,t){var n=m.request(e,t);return d("debug",e,"Request for '"+e+"' return '"+n+"' for parameters ",t),n},r.ctxRequest=function(e,t){var n=this.context;if(n===o.mqDefault)throw new Error("Request with context is available only on instances with custom context. Current context is default. ");n=m.ctxRequest(n,e,t);return d("debug",e,"Context request for '"+e+"' return '"+n+"' for parameters ",t),n},r.demand=function(e,t){var n=m.demand(e,t);return d("debug",e,"Demand for '"+e+"' return '"+n+"' for parameters ",t),n},r.watching=function(e){var t=m.watching(e);return d("debug",e,"Watching count status for '"+e+"' return '"+t,[]),t},r.subscribe=function(e,t,n,r,i){var o,l,a=this.context,e=function(e,t,n,r){if("string"==typeof e&&"function"==typeof t)return{element:null,name:e,handler:t,params:r||[]};var i=e.nodeType&&1===e.nodeType,o=e===document,l=e===globalThis;if((i||l||o)&&"string"==typeof t&&"function"==typeof n)return{element:e,name:t,handler:n,params:r||[]};throw new Error("EventEmitter: Incorrect parameters given into function subscribe() or unsubscribe().")}(e,t,n,r);function s(e){l.handler.apply(o,[[e].concat(l.params)])}return e.element?c(e.element,e.name,(o=a,t=(l=e).handler.handlers=l.handler.handlers||[],s.element=l.element,s.type=l.name,s.context=o,t.push(s),s),i):m.save(this.context,e.name,e.handler),this},r.unsubscribe=function(e,t,n){t=t,n=n;var r,i,u=void 0===(e=e)||void 0===t?{element:null,name:null,handler:null}:"string"==typeof e&&"function"==typeof t?{element:null,name:e,handler:t}:(u=e.nodeType&&1===e.nodeType,r=e===document,i=e===globalThis,(u||i||r)&&"string"==typeof t&&"function"==typeof n?{element:e,name:t,handler:n}:null);if(this.context!==o.mqDefault||u.name||u.handler||console.warn("EventEmitter: You are calling unsubscribe method without parameters. This is unbind all event through application!"),u.element){var c=this.context;var h=u;let e,t,n,r,i,o=[],l=h.name,a=h.element,s=h.handler.handlers||[];for(e=s.length-1;0<=e;e--)i=(r=s[e]).element,t=r.type,n=r.context,i===a&&l===t&&n===c?f(h.element,h.name,r):o.push(r);h.handler.handlers=o}else m.remove(this.context,u.name,u.handler);return this},r.interrupt=function(e,t,n){t&&((t=e).cancelBubble=!0,void 0!==t.stopPropagation)&&t.stopPropagation(),n&&((t=(t=e)||globalThis.event).preventDefault&&t.preventDefault(),t.returnValue=!1)},r.in=function(e){if(this.isStatic)throw new Error("EventEmitter: Can not change context on static method. Use EventEmitter.create() with right context.");return this.context=e,this},r.debugMode=function(e,t,n){a=t||[],s=e,u=n,r.getStore=e?function(){return m}:void 0,console.info("EventEmitter debug mode is set to "+(e?"on":"off")+" "+(n?"with simple mode":""))},r.version="1.0",e}(MQ),globalThis.EventEmitter&&console.warn(" EventEmitter already exists on globalThis, redefining"),globalThis.EventEmitter=new MQ.Emitter(!0);